<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理员面板</title>
    <link rel="icon" href="/css/all/icon.png" type="image/png">
    <link rel="stylesheet" href="/css/index/style.css">
    <link rel="stylesheet" href="/css/admin_panel/admin_panel.css">
</head>
<body class="admin-page">
    <button id="restart-btn" class="restart-btn">重启后端</button>
<a href="{{ url_for('admin_logout') }}"><button class="logout-btn">退出登录</button></a>
    <div class="container admin-container">
        <div class="box">
            <!-- 分页切换 -->
            <div class="tab-container">
                <button class="tab active" onclick="switchTab('files')">文件管理</button>
                <button class="tab" onclick="switchTab('settings')">功能设置</button>
                <button class="tab" onclick="switchTab('interface')">界面设置</button>
                <button class="tab" onclick="switchTab('onebot')">OneBot连接</button>
            </div>
            
            <!-- 文件管理内容 -->
            <div id="files" class="tab-content">
            {% if files %}
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>取件码</th>
                                <th>文件名</th>
                                <th>大小</th>
                                <th>过期时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for code, info in files.items() %}
                                <tr>
                                    <td>{{ code }}</td>
                                    <td>{{ info.original_filename }}</td>
                                    <td>{{ "%.2f MB"|format(info.size / (1024 * 1024)) }}</td>
                                    <td>{{ info.formatted_expire_time }}</td>
                                    <td>
                                        <form class="expire-form" method="post" action="{{ url_for('update_expire', code=code) }}">
                                            <select name="hours" class="expire-select">
                                                <option value="1">1小时</option>
                                                <option value="3">3小时</option>
                                                <option value="10">10小时</option>
                                                <option value="24">24小时</option>
                                            </select>
                                            <button type="submit" class="action-btn update-btn">更新</button>
                                        </form>
                                        <a href="{{ url_for('delete_file', code=code) }}" onclick="return confirm('确定要删除这个文件吗？');"><button class="action-btn delete-btn">删除</button></a>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="no-files">暂无文件</div>
            {% endif %}
        </div>
        
        <!-- 功能设置内容 -->
        <div id="settings" class="tab-content" style="display: none;">
            <form method="post" action="{{ url_for('update_admin_settings') }}">
                <div class="settings-forms">
                    <!-- 修改管理员密码 -->
                    <div class="setting-section">
                        <h3>修改管理员密码</h3>
                        <div class="form-group">
                            <label for="current_password">当前密码</label>
                            <input type="password" id="current_password" name="current_password" placeholder="请输入当前密码">
                        </div>
                        <div class="form-group">
                            <label for="new_password">新密码</label>
                            <input type="password" id="new_password" name="new_password" placeholder="请输入新密码">
                        </div>
                        <div class="form-group">
                            <label for="confirm_password">确认新密码</label>
                            <input type="password" id="confirm_password" name="confirm_password" placeholder="请再次输入新密码">
                        </div>
                    </div>
                    
                    <!-- 设置最大文件大小 -->
                    <div class="setting-section">
                        <h3>设置最大文件大小</h3>
                        <div class="form-group">
                            <label for="max_file_size">最大文件大小（MB）</label>
                            <input type="number" id="max_file_size" name="max_file_size" value="{{ max_file_size }}" min="1" max="1024">
                        </div>
                    </div>
                    
                    <!-- 设置网站公告 -->
                    <div class="setting-section">
                        <h3>设置网站公告</h3>
                        <div class="form-group">
                            <label for="announcement">公告内容</label>
                            <textarea id="announcement" name="announcement" placeholder="请输入公告内容">{{ announcement }}</textarea>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn update-btn">保存设置</button>
                    {% if error %}
                        <div class="error">{{ error }}</div>
                    {% endif %}
                    {% if success %}
                        <div class="success">{{ success }}</div>
                    {% endif %}
                </div>
            </form>
        </div>
        
        <!-- 界面设置内容 -->
        <div id="interface" class="tab-content" style="display: none;">
            <form method="post" action="{{ url_for('update_admin_settings') }}" enctype="multipart/form-data">
                <div class="settings-forms">
                    <!-- 背景图设置 -->
                    <div class="setting-section">
                        <h3>网页背景图设置</h3>
                        <div class="form-group">
                            <label for="background_image">上传新背景图</label>
                            <div class="file-upload-container">
                                <input type="file" id="background_image" name="background_image" accept="image/*">
                                <label for="background_image" class="file-label">选择图片</label>
                                <span id="selected-image" class="file-name">未选择图片</span>
                            </div>
                            <p class="note">支持JPG、PNG等常见图片格式，建议尺寸：1920x1080像素</p>
                        </div>
                        
                        <div class="current-bg-preview">
                            <h4>当前背景图预览</h4>
                            <div class="preview-container">
                                <img id="current-bg-image" src="/css/all/bg.png" alt="当前背景图" class="bg-preview">
                            </div>
                        </div>
                    </div>
                    
                    <!-- 网站图标设置 -->
                    <div class="setting-section">
                        <h3>网页图标设置</h3>
                        <div class="form-group">
                            <label for="favicon">上传新图标</label>
                            <div class="file-upload-container">
                                <input type="file" id="favicon" name="favicon" accept="image/*">
                                <label for="favicon" class="file-label">选择图标</label>
                                <span id="selected-favicon" class="file-name">未选择图标</span>
                            </div>
                            <p class="note">支持PNG格式，建议尺寸：32x32像素或64x64像素，文件大小不超过1MB</p>
                        </div>
                        
                        <div class="current-bg-preview">
                            <h4>当前图标预览</h4>
                            <div class="preview-container">
                                <img id="current-favicon" src="/css/all/icon.png" alt="当前图标" class="bg-preview" style="max-width: 64px; max-height: 64px;">
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn update-btn">更新设置</button>
                    {% if error %}
                        <div class="error">{{ error }}</div>
                    {% endif %}
                    {% if success %}
                        <div class="success">{{ success }}</div>
                    {% endif %}
                </div>
            </form>
        </div>
        
        <!-- OneBot连接内容 -->
        <div id="onebot" class="tab-content" style="display: none;">
            <form method="post" action="{{ url_for('update_admin_settings') }}">
                <div class="settings-forms">
                    <!-- 推送设置 -->
                    <div class="setting-section">
                        <h3>推送开关</h3>
                        <div class="form-group">
                            <div class="switch-container">
                                <span class="switch-label">推送开关</span>
                                <label class="switch">
                                    <input type="checkbox" id="onebot_push" name="onebot_push"{% if onebot_push %} checked{% endif %}>
                                    <span class="switch-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 连接配置 -->
                    <div class="setting-section">
                        <h3>连接配置</h3>
                        <div class="form-group">
                            <label for="onebot_port">本地OneBot端口</label>
                            <input type="number" id="onebot_port" name="onebot_port" value="{{ onebot_port }}" placeholder="请输入端口号" min="1024" max="65535" required>
                        </div>
                        <div class="form-group">
                            <label for="onebot_group_id">QQ群号</label>
                            <input type="text" id="onebot_group_id" name="onebot_group_id" value="{{ onebot_group_id }}" placeholder="请输入QQ群号" required>
                        </div>
                    </div>
                    
                    <!-- 功能测试 -->
                    <div class="setting-section">
                        <h3>功能测试</h3>
                        <div class="form-group">
                            <button type="button" id="test_push_btn" class="btn update-btn">测试推送</button>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn update-btn">保存设置</button>
                    {% if error %}
                        <div class="error">{{ error }}</div>
                    {% endif %}
                    {% if success %}
                        <div class="success">{{ success }}</div>
                    {% endif %}
                </div>
            </form>
        </div>
        
        <script src="/js/admin_panel/admin_panel.js"></script>
    </div>
</div>
</body>
</html>